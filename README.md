# Docling RU Demo

Простой Python скрипт для тестирования и отладки распознавания PDF файлов на русском языке со сложной структурой с помощью [Docling](https://github.com/DS4SD/docling) от IBM.

## Возможности

✓ **Конвертация PDF в Markdown** - высококачественное преобразование документов  
✓ **Поддержка русского языка** - встроенная поддержка OCR для русского текста  
✓ **Сложные структуры** - таблицы, изображения, формулы, код  
✓ **Apple Silicon оптимизация** - автоматическое использование GPU на M1/M2/M3 чипах  
✓ **OCR для отсканированных документов** - распознавание текста с изображений  

## Требования

- Python 3.8 или выше
- macOS 12.3+ (для поддержки Apple Silicon GPU) или Linux/Windows

## Установка

### Автоматическая установка (рекомендуется)

```bash
git clone https://github.com/rislanov/docling-ru-demo.git
cd docling-ru-demo
./install.sh
```

### Ручная установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/rislanov/docling-ru-demo.git
cd docling-ru-demo
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Проверьте установку:
```bash
python3 check_deps.py
```

**Примечание:** Первый запуск может занять время, так как Docling загрузит необходимые AI модели (~500MB).

## Использование

### Базовое использование

Конвертация PDF файла в Markdown:
```bash
python pdf_to_md.py document.pdf
```

Результат будет сохранён в `document.md` в той же директории.

### Указание выходного файла

```bash
python pdf_to_md.py document.pdf -o output.md
```

### Полные пути

```bash
python pdf_to_md.py /path/to/document.pdf -o /path/to/output.md
```

### Справка

```bash
python pdf_to_md.py --help
```

## Примеры работы

```bash
$ python pdf_to_md.py example.pdf
============================================================
Входной файл: /Users/user/documents/example.pdf
Выходной файл: /Users/user/documents/example.md
============================================================

✓ Используется Apple Silicon GPU (Metal Performance Shaders)
Начинаем обработку PDF...
Это может занять некоторое время в зависимости от размера и сложности документа...

✓ Успешно конвертировано!
✓ Результат сохранён в: /Users/user/documents/example.md

Статистика:
  - Размер выходного файла: 15.42 КБ
  - Количество символов: 15789
```

## Поддержка Apple Silicon (M1/M2/M3)

Скрипт автоматически определяет доступность Apple Silicon GPU и использует Metal Performance Shaders (MPS) для ускорения обработки. Это обеспечивает:

- Значительное ускорение обработки по сравнению с CPU
- Эффективное использование единой памяти (unified memory)
- Поддержка больших документов

Для оптимальной производительности убедитесь, что установлена последняя версия PyTorch с поддержкой MPS.

## Архитектура

Скрипт использует следующие компоненты:

1. **Docling** - основной движок для конвертации документов
2. **PyTorch** - для AI моделей распознавания структуры
3. **OCR backend (EasyOCR)** - для распознавания текста на русском языке
4. **MPS backend** - для ускорения на Apple Silicon

## Устранение неполадок

### Проблемы с установкой

Если возникают проблемы при установке зависимостей:

```bash
# Обновите pip
pip install --upgrade pip

# Переустановите зависимости
pip install -r requirements.txt --no-cache-dir
```

### Проблемы с памятью

Для очень больших PDF файлов может потребоваться больше памяти. На Apple Silicon можно использовать:

```bash
# Увеличить лимит памяти для Python
ulimit -s 65536
python pdf_to_md.py large_document.pdf
```

### OCR не работает с русским языком

Убедитесь, что установлены все зависимости Docling. При первом запуске библиотека автоматически загрузит необходимые языковые модели.

## Структура проекта

```
docling-ru-demo/
├── pdf_to_md.py        # Основной скрипт конвертации
├── check_deps.py       # Скрипт проверки зависимостей
├── install.sh          # Скрипт автоматической установки
├── requirements.txt    # Список зависимостей Python
├── README.md          # Документация (этот файл)
└── .gitignore         # Игнорируемые файлы
```

## Технические детали

### Поддерживаемые форматы входных данных
- PDF (включая отсканированные документы)
- Поддержка различных кодировок текста

### Выходной формат
- Markdown (.md)
- Сохранение структуры документа
- Поддержка таблиц, списков, заголовков
- Извлечение изображений в виде ссылок

### Производительность

Время обработки зависит от:
- Размера документа
- Сложности структуры
- Наличия отсканированных страниц (OCR медленнее)
- Используемого оборудования (CPU vs GPU)

Примерное время для документа на 10 страниц:
- CPU: 30-60 секунд
- Apple Silicon GPU (MPS): 10-20 секунд

## Лицензия

Этот проект использует Docling от IBM, который распространяется под лицензией MIT.

## Ссылки

- [Docling GitHub](https://github.com/DS4SD/docling)
- [Документация Docling](https://docling-project.github.io/docling/)
- [PyTorch MPS Support](https://pytorch.org/docs/stable/notes/mps.html)

## Автор

Демонстрационный проект для тестирования возможностей Docling с русскоязычными документами.